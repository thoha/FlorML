#!/usr/bin/perl
# namefinder.pl
# Finds remaining names


use warnings;
use strict;
use utf8;
use open ':encoding(utf8)';

my $source = shift @ARGV;
my $destination = shift @ARGV;

open IN, $source or die "Can't read source file $source: $!\n";
open OUT, "> $destination" or die "can't write on file $destination: $!\n";

while (<IN>) {

	
	
	if (/(<string>|<\/string>|<br \/>|<li>|<figureLegend>|<char|<subChar|<tableTitle>|<th>|<td>|<footnote)/) {
		# Finds remaining names in normal text:
		
		# Varieties:
		# With author:
		s/( |>)((?:[[:upper:]](?:[[:lower:]]+|\.)) (?:[[:lower:]]+) (?:(?:\((?:Acev\.-Rodr\.|E\. J\. Alexander|Andre(?: ex Mez|)|Antoine|Aubl(?:\.|et)|Baill(?:\.|)|Baker|P\. Beauv\.|(?:Spruce ex |)Benth(?:\.|am)|Benoist|(?:C\.C\. |)Berg|Blume|Bogin|(?:Humb\. &amp; |)Bonpl\.|Bremek\.|Brongniart|N\.(?: |)E\. Br(?:\.|own)|Buchenau|Cambess\.|Cham\.|Chapm\.|Choisy|J\.L\. Clark|(?:Bertero ex |)Colla|(?:C\. |)DC\.|Decne\.|Desf\.|Desv\.|A\. Dietr\.|(?:D\.|G\.) Don(?: ex Steud\.|)|Duchartre|Ducke|Eichler|(?:Sagot ex |)Engl(?:\.|er)|Exell|Fassett|J\.R\. &amp; G\. Forster|Fosb\.|Fritsch|Garcke|C\.F\. Gaertn\.|Gaud\.(?: ex Wedd\.|)|Gleason|J\.F\. Gmel|Gouda|V\.A\.W\. Graham|Griseb(?:\.|ach)|(?:Klotzsch ex |)Hanst\.|Hara|Heimerl|Hiern|Hoehne|(?:R\.R\. Haynes &amp; |)Holm-Niels\.|Hook\.(?:f\.|)|Houtt\.|(?:R\.A\. |)Howard|Huber|Jacq\.|Jongkind|Klotzsch|Salisb\. ex Knight|Kosterm\.|Kral|K\. Krause|Krug &amp; Urb\.|Kubitzki|Kuijt|Kuhlm\.|(?:Poeppig ex |)Kunth(?: &amp; C\.D\. Bouché|)|(?:O\. |)Kuntze|L\.(?: f\.|)|Lag\. &amp; Rodr\.|Lam\.|Lanj(?:ouw|\.)(?: &amp; Rossberg|)|Leeuwenb\.|Lindau|Linden|Link(?:, Klotzsch &amp; Otto|)|Lodd\.|Loefl\.|Loes\.|Lundell|Lour\.|Maas(?: &amp; Stoel|)|Macbr\.|Maguire(?: &amp; (?:Wurdack|L\.B\. Smith)|)|(?:Spruce ex |)Malme|(?:Nees &amp; |)Mart(?:\.|ius)(?: ex Nees|)|Masters|Meisn\.|A\.M\. Mennega|Merr\.|G\. Mey\.|Mez|Micheli|(?:Spruce ex |)Miers|Mildbr\.|Mill\.|Miq\.|S. Moore|C\.V\. Morton|Nees|(?:Hieron. ex |)Niederlein|A\. Nilsson|F\. Oliver|Pers\.|Peyr\.|Pitt|Planch\.|Poepp\.(?: &amp; Endl\.|)|Poir\.|Poncy|Prance|C\. Presl|Pulle|(?:Sagot ex |)Radlk\.|Rataj|Rchb\.|Regel|Reitz|(?:L\.C\. |)Rich\.|Rizzini|Roxb\.|Rudge|Ruiz &amp; Pav(?:\.|on)|Rusby|Salisb\.|Sandw\.|Sarg\.|Schott|Schwarz|Seem\.|Sesse|Seub\.|(?:Bojer ex |Donn ex |)Sims|Small|(?:A\.C\.|(?:R\.(?: |)W\. Read &amp; |)L\.B\.) Smith(?: &amp; Pitt(?:\.|endrigh)|)|(?:A\. |)Spreng(?:\.|el)|Spruce|B\. Ståhl|Stand(?:l|)\.|Steud\.|Steyerm\.(?: &amp; Berry|)|Stuntz|Sw\.|Taub\.|J\.V\. Thomps\.|Todzia|Torr\.|Triana|Trecul|Ule|Urb\.|Vahl|Vazquez Avila(?: &amp; C\.C\. Berg)|Veil\.|Vellozo|H\. Walt\.|Wassh\.|Wedd\.|Wendland|Wiehler|Wight|Willdenow|Willd\.|C\.(?:H\.|) Wright|(?:Trel\. &amp; |)Yunck\.)\)) |)(?:Acev\.-Rodr\.|E\. J\. Alexander|Andre(?: ex Mez|)|Antoine|Aubl(?:\.|et)|Baill(?:\.|)|Baker|P\. Beauv\.|(?:Spruce ex |)Benth(?:\.|am)|Benoist|(?:C\.C\. |)Berg|Blume|Bogin|(?:Humb\. &amp; |)Bonpl\.|Bremek\.|Brongniart|N\.(?: |)E\. Br(?:\.|own)|Buchenau|Cambess\.|Cham\.|Chapm\.|Choisy|J\.L\. Clark|(?:Bertero ex |)Colla|(?:C\. |)DC\.|Decne\.|Desf\.|Desv\.|A\. Dietr\.|(?:D\.|G\.) Don(?: ex Steud\.|)|Duchartre|Ducke|Eichler|(?:Sagot ex |)Engl(?:\.|er)|Exell|Fassett|J\.R\. &amp; G\. Forster|Fosb\.|Fritsch|Garcke|C\.F\. Gaertn\.|Gaud\.(?: ex Wedd\.|)|Gleason|J\.F\. Gmel|Gouda|V\.A\.W\. Graham|Griseb(?:\.|ach)|(?:Klotzsch ex |)Hanst\.|Hara|Heimerl|Hiern|Hoehne|(?:R\.R\. Haynes &amp; |)Holm-Niels\.|Hook\.(?:f\.|)|Houtt\.|(?:R\.A\. |)Howard|Huber|Jacq\.|Jongkind|Klotzsch|Salisb\. ex Knight|Kosterm\.|Kral|K\. Krause|Krug &amp; Urb\.|Kubitzki|Kuijt|Kuhlm\.|(?:Poeppig ex |)Kunth(?: &amp; C\.D\. Bouché|)|(?:O\. |)Kuntze|L\.(?: f\.|)|Lag\. &amp; Rodr\.|Lam\.|Lanj(?:ouw|\.)(?: &amp; Rossberg|)|Leeuwenb\.|Lindau|Linden|Link(?:, Klotzsch &amp; Otto|)|Lodd\.|Loefl\.|Loes\.|Lundell|Lour\.|Maas(?: &amp; Stoel|)|Macbr\.|Maguire(?: &amp; (?:Wurdack|L\.B\. Smith)|)|(?:Spruce ex |)Malme|(?:Nees &amp; |)Mart(?:\.|ius)(?: ex Nees|)|Masters|Meisn\.|A\.M\. Mennega|Merr\.|G\. Mey\.|Mez|Micheli|(?:Spruce ex |)Miers|Mildbr\.|Mill\.|Miq\.|S. Moore|C\.V\. Morton|Nees|(?:Hieron. ex |)Niederlein|A\. Nilsson|F\. Oliver|Pers\.|Peyr\.|Pitt|Planch\.|Poepp\.(?: &amp; Endl\.|)|Poir\.|Poncy|Prance|C\. Presl|Pulle|(?:Sagot ex |)Radlk\.|Rataj|Rchb\.|Regel|Reitz|(?:L\.C\. |)Rich\.|Rizzini|Roxb\.|Rudge|Ruiz &amp; Pav(?:\.|on)|Rusby|Salisb\.|Sandw\.|Sarg\.|Schott|Schwarz|Seem\.|Sesse|Seub\.|(?:Bojer ex |Donn ex |)Sims|Small|(?:A\.C\.|(?:R\.(?: |)W\. Read &amp; |)L\.B\.) Smith(?: &amp; Pitt(?:\.|endrigh)|)|(?:A\. |)Spreng(?:\.|el)|Spruce|B\. Ståhl|Stand(?:l|)\.|Steud\.|Steyerm\.(?: &amp; Berry|)|Stuntz|Sw\.|Taub\.|J\.V\. Thomps\.|Todzia|Torr\.|Triana|Trecul|Ule|Urb\.|Vahl|Vazquez Avila(?: &amp; C\.C\. Berg)|Veil\.|Vellozo|H\. Walt\.|Wassh\.|Wedd\.|Wendland|Wiehler|Wight|Willdenow|Willd\.|C\.(?:H\.|) Wright|(?:Trel\. &amp; |)Yunck\.) var\. [[:lower:]]+ (?:\([[:upper:]][[:lower:]\.]+\) |)(?:(?:[[:upper:]\.]+ |)[[:upper:]][[:lower:]]+(?:\.|)))( |, |; |: |\.|<|\)|")/$1<fullName rank="variety" freetextName="true">$2<\/fullName>$3/g;
		# Without author:
		s/( |>)(Peperomia velloziana var\. polysticta|Abolboda acaulis Maguire var\. acaulis)( |, |; |: |\.|<)/$1<fullName rank="variety">$2<\/fullName>$3/g;
		
		
		# Subspecies:
		# With author:
		s/( |>)((?:[[:upper:]](?:[[:lower:]]+|\.)) (?:[[:lower:]]+) (?:(?:\((?:Acev\.-Rodr\.|E\. J\. Alexander|Andre(?: ex Mez|)|Antoine|Aubl(?:\.|et)|Baill(?:\.|)|Baker|P\. Beauv\.|(?:Spruce ex |)Benth(?:\.|am)|Benoist|(?:C\.C\. |)Berg|Blume|Bogin|(?:Humb\. &amp; |)Bonpl\.|Bremek\.|Brongniart|N\.(?: |)E\. Br(?:\.|own)|Buchenau|Cambess\.|Cham\.|Chapm\.|Choisy|J\.L\. Clark|(?:Bertero ex |)Colla|(?:C\. |)DC\.|Decne\.|Desf\.|Desv\.|A\. Dietr\.|(?:D\.|G\.) Don(?: ex Steud\.|)|Duchartre|Ducke|Eichler|(?:Sagot ex |)Engl(?:\.|er)|Exell|Fassett|J\.R\. &amp; G\. Forster|Fosb\.|Fritsch|Garcke|C\.F\. Gaertn\.|Gaud\.(?: ex Wedd\.|)|Gleason|J\.F\. Gmel|Gouda|V\.A\.W\. Graham|Griseb(?:\.|ach)|(?:Klotzsch ex |)Hanst\.|Hara|Heimerl|Hiern|Hoehne|(?:R\.R\. Haynes &amp; |)Holm-Niels\.|Hook\.(?:f\.|)|Houtt\.|(?:R\.A\. |)Howard|Huber|Jacq\.|Jongkind|Klotzsch|Salisb\. ex Knight|Kosterm\.|Kral|K\. Krause|Krug &amp; Urb\.|Kubitzki|Kuijt|Kuhlm\.|(?:Poeppig ex |)Kunth(?: &amp; C\.D\. Bouché|)|(?:O\. |)Kuntze|L\.(?: f\.|)|Lag\. &amp; Rodr\.|Lam\.|Lanj(?:ouw|\.)(?: &amp; Rossberg|)|Leeuwenb\.|Lindau|Linden|Link(?:, Klotzsch &amp; Otto|)|Lodd\.|Loefl\.|Loes\.|Lundell|Lour\.|Maas(?: &amp; Stoel|)|Macbr\.|Maguire(?: &amp; (?:Wurdack|L\.B\. Smith)|)|(?:Spruce ex |)Malme|(?:Nees &amp; |)Mart(?:\.|ius)(?: ex Nees|)|Masters|Meisn\.|A\.M\. Mennega|Merr\.|G\. Mey\.|Mez|Micheli|(?:Spruce ex |)Miers|Mildbr\.|Mill\.|Miq\.|S. Moore|C\.V\. Morton|Nees|(?:Hieron. ex |)Niederlein|A\. Nilsson|F\. Oliver|Pers\.|Peyr\.|Pitt|Planch\.|Poepp\.(?: &amp; Endl\.|)|Poir\.|Poncy|Prance|C\. Presl|Pulle|(?:Sagot ex |)Radlk\.|Rataj|Rchb\.|Regel|Reitz|(?:L\.C\. |)Rich\.|Rizzini|Roxb\.|Rudge|Ruiz &amp; Pav(?:\.|on)|Rusby|Salisb\.|Sandw\.|Sarg\.|Schott|Schwarz|Seem\.|Sesse|Seub\.|(?:Bojer ex |Donn ex |)Sims|Small|(?:A\.C\.|(?:R\.(?: |)W\. Read &amp; |)L\.B\.) Smith(?: &amp; Pitt(?:\.|endrigh)|)|(?:A\. |)Spreng(?:\.|el)|Spruce|B\. Ståhl|Stand(?:l|)\.|Steud\.|Steyerm\.(?: &amp; Berry|)|Stuntz|Sw\.|Taub\.|J\.V\. Thomps\.|Todzia|Torr\.|Triana|Trecul|Ule|Urb\.|Vahl|Vazquez Avila(?: &amp; C\.C\. Berg)|Veil\.|Vellozo|H\. Walt\.|Wassh\.|Wedd\.|Wendland|Wiehler|Wight|Willdenow|Willd\.|C\.(?:H\.|) Wright|(?:Trel\. &amp; |)Yunck\.)\)) |)(?:Acev\.-Rodr\.|E\. J\. Alexander|Andre(?: ex Mez|)|Antoine|Aubl(?:\.|et)|Baill(?:\.|)|Baker|P\. Beauv\.|(?:Spruce ex |)Benth(?:\.|am)|Benoist|(?:C\.C\. |)Berg|Blume|Bogin|(?:Humb\. &amp; |)Bonpl\.|Bremek\.|Brongniart|N\.(?: |)E\. Br(?:\.|own)|Buchenau|Cambess\.|Cham\.|Chapm\.|Choisy|J\.L\. Clark|(?:Bertero ex |)Colla|(?:C\. |)DC\.|Decne\.|Desf\.|Desv\.|A\. Dietr\.|(?:D\.|G\.) Don(?: ex Steud\.|)|Duchartre|Ducke|Eichler|(?:Sagot ex |)Engl(?:\.|er)|Exell|Fassett|J\.R\. &amp; G\. Forster|Fosb\.|Fritsch|Garcke|C\.F\. Gaertn\.|Gaud\.(?: ex Wedd\.|)|Gleason|J\.F\. Gmel|Gouda|V\.A\.W\. Graham|Griseb(?:\.|ach)|(?:Klotzsch ex |)Hanst\.|Hara|Heimerl|Hiern|Hoehne|(?:R\.R\. Haynes &amp; |)Holm-Niels\.|Hook\.(?:f\.|)|Houtt\.|(?:R\.A\. |)Howard|Huber|Jacq\.|Jongkind|Klotzsch|Salisb\. ex Knight|Kosterm\.|Kral|K\. Krause|Krug &amp; Urb\.|Kubitzki|Kuijt|Kuhlm\.|(?:Poeppig ex |)Kunth(?: &amp; C\.D\. Bouché|)|(?:O\. |)Kuntze|L\.(?: f\.|)|Lag\. &amp; Rodr\.|Lam\.|Lanj(?:ouw|\.)(?: &amp; Rossberg|)|Leeuwenb\.|Lindau|Linden|Link(?:, Klotzsch &amp; Otto|)|Lodd\.|Loefl\.|Loes\.|Lundell|Lour\.|Maas(?: &amp; Stoel|)|Macbr\.|Maguire(?: &amp; (?:Wurdack|L\.B\. Smith)|)|(?:Spruce ex |)Malme|(?:Nees &amp; |)Mart(?:\.|ius)(?: ex Nees|)|Masters|Meisn\.|A\.M\. Mennega|Merr\.|G\. Mey\.|Mez|Micheli|(?:Spruce ex |)Miers|Mildbr\.|Mill\.|Miq\.|S. Moore|C\.V\. Morton|Nees|(?:Hieron. ex |)Niederlein|A\. Nilsson|F\. Oliver|Pers\.|Peyr\.|Pitt|Planch\.|Poepp\.(?: &amp; Endl\.|)|Poir\.|Poncy|Prance|C\. Presl|Pulle|(?:Sagot ex |)Radlk\.|Rataj|Rchb\.|Regel|Reitz|(?:L\.C\. |)Rich\.|Rizzini|Roxb\.|Rudge|Ruiz &amp; Pav(?:\.|on)|Rusby|Salisb\.|Sandw\.|Sarg\.|Schott|Schwarz|Seem\.|Sesse|Seub\.|(?:Bojer ex |Donn ex |)Sims|Small|(?:A\.C\.|(?:R\.(?: |)W\. Read &amp; |)L\.B\.) Smith(?: &amp; Pitt(?:\.|endrigh)|)|(?:A\. |)Spreng(?:\.|el)|Spruce|B\. Ståhl|Stand(?:l|)\.|Steud\.|Steyerm\.(?: &amp; Berry|)|Stuntz|Sw\.|Taub\.|J\.V\. Thomps\.|Todzia|Torr\.|Triana|Trecul|Ule|Urb\.|Vahl|Vazquez Avila(?: &amp; C\.C\. Berg)|Veil\.|Vellozo|H\. Walt\.|Wassh\.|Wedd\.|Wendland|Wiehler|Wight|Willdenow|Willd\.|C\.(?:H\.|) Wright|(?:Trel\. &amp; |)Yunck\.) subsp\. [[:lower:]]+ (?:\([[:upper:]][[:lower:]\.]+\) |)(?:(?:[[:upper:]\.]+ |)[[:upper:]][[:lower:]]+(?:\.|)))( |, |; |: |\.|<|\)|")/$1<fullName rank="subspecies" freetextName="true">$2<\/fullName>$3/g;
		# Without author:
		s/( |\(|>)(Schiekia orinocensis subsp\. silvestris)( |, |; |: |\.|<|\))/$1<fullName rank="subspecies">$2<\/fullName>$3/g;
		
		
		# Species:
		# With author:
		s/( |(?<!variety"|species")(?<!true")>)((?:[[:upper:]](?:[[:lower:]]+|\.)) (?:[[:lower:]-]+) (?:(?:\((?:Acev\.-Rodr\.|E\. J\. Alexander|Andre(?: ex Mez|)|Antoine|Aubl(?:\.|et)|Baill(?:\.|)|Baker|P\. Beauv\.|(?:Spruce ex |)Benth(?:\.|am)|Benoist|(?:C\.C\. |)Berg|Blume|Bogin|(?:Humb\. &amp; |)Bonpl\.|Bremek\.|Brongniart|N\.(?: |)E\. Br(?:\.|own)|Buchenau|Cambess\.|Cham\.|Chapm\.|Choisy|J\.L\. Clark|(?:Bertero ex |)Colla|(?:C\. |)DC\.|Decne\.|Desf\.|Desv\.|A\. Dietr\.|(?:D\.|G\.) Don(?: ex Steud\.|)|Duchartre|Ducke|Eichler|(?:Sagot ex |)Engl(?:\.|er)|Exell|Fassett|J\.R\. &amp; G\. Forster|Fosb\.|Fritsch|Garcke|C\.F\. Gaertn\.|Gaud\.(?: ex Wedd\.|)|Gleason|J\.F\. Gmel|Gouda|V\.A\.W\. Graham|Griseb(?:\.|ach)|(?:Klotzsch ex |)Hanst\.|Hara|Heimerl|Hiern|Hoehne|(?:R\.R\. Haynes &amp; |)Holm-Niels\.|Hook\.(?:f\.|)|Houtt\.|(?:R\.A\. |)Howard|Huber|Jacq\.|Jongkind|Klotzsch|Salisb\. ex Knight|Kosterm\.|Kral|K\. Krause|Krug &amp; Urb\.|Kubitzki|Kuijt|Kuhlm\.|(?:Poeppig ex |)Kunth(?: &amp; C\.D\. Bouché|)|(?:O\. |)Kuntze|L\.(?: f\.|)|Lag\. &amp; Rodr\.|Lam\.|Lanj(?:ouw|\.)(?: &amp; Rossberg|)|Leeuwenb\.|Lepis|Lindau|Linden|Link(?:, Klotzsch &amp; Otto|)|Lodd\.|Loefl\.|Loes\.|Lundell|Lour\.|Maas(?: &amp; Stoel|)|Macbr\.|Maguire(?: &amp; (?:Wurdack|L\.B\. Smith)|)|(?:Spruce ex |)Malme|(?:Nees &amp; |)Mart(?:\.|ius)(?: ex Nees|)|Masters|Meisn\.|A\.M\. Mennega|Merr\.|G\. Mey\.|Mez|Micheli|(?:Spruce ex |)Miers|Mildbr\.|Mill\.|Miq\.|S. Moore|C\.V\. Morton|Nees|(?:Hieron. ex |)Niederlein|A\. Nilsson|F\. Oliver|Pers\.|Peyr\.|Pitt|Planch\.|Poepp\.(?: &amp; Endl\.|)|Poir\.|Poncy|Prance|C\. Presl|Pulle|(?:Sagot ex |)Radlk\.|Rataj|Rchb\.|Regel|Reitz|(?:L\.C\. |)Rich\.|Rizzini|Roxb\.|Rudge|Ruiz &amp; Pav(?:\.|on)|Rusby|Salisb\.|Sandw\.|Sarg\.|Schott|Schwarz|Seem\.|Sesse|Seub\.|(?:Bojer ex |Donn ex |)Sims|Small|(?:A\.C\.|(?:R\.(?: |)W\. Read &amp; |)L\.B\.) Smith(?: &amp; Pitt(?:\.|endrigh)|)|(?:A\. |)Spreng(?:\.|el)|Spruce|B\. Ståhl|Stand(?:l|)\.|Steud\.|Steyerm\.(?: &amp; Berry|)|Struwe|Stuntz|Sw\.|Taub\.|J\.V\. Thomps\.|Todzia|Torr\.|Triana|Trecul|Ule|Urb\.|Vahl|Vazquez Avila(?: &amp; C\.C\. Berg)|Veil\.|Vellozo|H\. Walt\.|Wassh\.|Wedd\.|Wendland|Wiehler|Wight|Willdenow|Willd\.|C\.(?:H\.|) Wright|(?:Trel\. &amp; |)Yunck\.)\)) |)(?:Acev\.-Rodr\.|E\. J\. Alexander|Andre(?: ex Mez|)|Antoine|Aubl(?:\.|et)|Baill(?:\.|)|Baker|P\. Beauv\.|(?:Spruce ex |)Benth(?:\.|am)|Benoist|(?:C\.C\. |)Berg|Blume|Bogin|(?:Humb\. &amp; |)Bonpl\.|Bremek\.|Brongniart|N\.(?: |)E\. Br(?:\.|own)|Buchenau|Cambess\.|Cham\.|Chapm\.|Choisy|J\.L\. Clark|(?:Bertero ex |)Colla|(?:C\. |)DC\.|Decne\.|Desf\.|Desv\.|A\. Dietr\.|(?:D\.|G\.) Don(?: ex Steud\.|)|Duchartre|Ducke|Eichler|(?:Sagot ex |)Engl(?:\.|er)|Exell|Fassett|J\.R\. &amp; G\. Forster|Fosb\.|Fritsch|Garcke|C\.F\. Gaertn\.|Gaud\.(?: ex Wedd\.|)|Gleason|J\.F\. Gmel|Gouda|V\.A\.W\. Graham|Griseb(?:\.|ach)|(?:Klotzsch ex |)Hanst\.|Hara|Heimerl|Hiern|Hoehne|(?:R\.R\. Haynes &amp; |)Holm-Niels\.|Hook\.(?:f\.|)|Houtt\.|(?:R\.A\. |)Howard|Huber|Jacq\.|Jongkind|Klotzsch|Salisb\. ex Knight|Kosterm\.|Kral|K\. Krause|Krug &amp; Urb\.|Kubitzki|Kuijt|Kuhlm\.|(?:Poeppig ex |)Kunth(?: &amp; C\.D\. Bouché|)|(?:O\. |)Kuntze|L\.(?: f\.|)|Lag\. &amp; Rodr\.|Lam\.|Lanj(?:ouw|\.)(?: &amp; Rossberg|)|Leeuwenb\.|Lepis|Lindau|Linden|Link(?:, Klotzsch &amp; Otto|)|Lodd\.|Loefl\.|Loes\.|Lundell|Lour\.|Maas(?: &amp; Stoel|)|Macbr\.|Maguire(?: &amp; (?:Wurdack|L\.B\. Smith)|)|(?:Spruce ex |)Malme|(?:Nees &amp; |)Mart(?:\.|ius)(?: ex Nees|)|Masters|Meisn\.|A\.M\. Mennega|Merr\.|G\. Mey\.|Mez|Micheli|(?:Spruce ex |)Miers|Mildbr\.|Mill\.|Miq\.|S. Moore|C\.V\. Morton|Nees|(?:Hieron. ex |)Niederlein|A\. Nilsson|F\. Oliver|Pers\.|Peyr\.|Pitt|Planch\.|Poepp\.(?: &amp; Endl\.|)|Poir\.|Poncy|Prance|C\. Presl|Pulle|(?:Sagot ex |)Radlk\.|Rataj|Rchb\.|Regel|Reitz|(?:L\.C\. |)Rich\.|Rizzini|Roxb\.|Rudge|Ruiz &amp; Pav(?:\.|on)|Rusby|Salisb\.|Sandw\.|Sarg\.|Schott|Schwarz|Seem\.|Sesse|Seub\.|(?:Bojer ex |Donn ex |)Sims|Small|(?:A\.C\.|(?:R\.(?: |)W\. Read &amp; |)L\.B\.) Smith(?: &amp; Pitt(?:\.|endrigh)|)|(?:A\. |)Spreng(?:\.|el)|Spruce|B\. Ståhl|Stand(?:l|)\.|Steud\.|Steyerm\.(?: &amp; Berry|)|Struwe|Stuntz|Sw\.|Taub\.|J\.V\. Thomps\.|Todzia|Torr\.|Triana|Trecul|Ule|Urb\.|Vahl|Vazquez Avila(?: &amp; C\.C\. Berg)|Veil\.|Vellozo|H\. Walt\.|Wassh\.|Wedd\.|Wendland|Wiehler|Wight|Willdenow|Willd\.|C\.(?:H\.|) Wright|(?:Trel\. &amp; |)Yunck\.))( |,|; |: |\.|<|\)|")/$1<fullName rank="species" freetextName="true">$2<\/fullName>$3/g;
		# Without #1:
		s/( |(?<!variety"|species")(?<!true")>)((?:[[:upper:]]\.) (?:[[:lower:]]+))( |,|; |: |\.|\)|<)/$1<fullName rank="species" freetextName="true">$2<\/fullName>$3/g;
		# Fixes "L. var" being recognized as a species name:
		s/(<fullName rank="species" freetextName="true">)(L\. var)(<\/fullName>)/$2/g;
		# Without #2 (trying to write a regex that grabs all names of the below format has a lot of colateral damage, so we do it the crude way):
		s/( |\(|(?<!variety"|species")(?<!true")>)((?:[[:upper:]][[:lower:]]+|[[:upper:]]\.) (?:acuminata|alatabaccum|alatus|albert-smithii|alveolatus|amalago|amara|amazonicum|americana|anceps|angustat(?:a|us)|anomalum|anomophylla|anonifolium|apella|arboreum|augustum|aulacospermum|balbisiana|bella|bertero(?:anum|niana)|bijugatus|bilobata|blandum|brasiliensis|breviflora|brownsbergense|bulbosa|cacoucia|caeruleum|cajan|calotricha|capitulifera|capituligera|carica|catalpifolium|cernuum|cinerea|coarctata|cognatum|complanata|consanguineum|coruscans|crassifolium|crepitans|cristat(?:a|us)|cupana|cylindrocarpa|delascioi|diffusiflorum|dilatatum|dipterum|disjectifolia|diversifolia|donnell-smithii|duidae|eggersiana|elegans|elliptica|equisetifolia|fanshawei|fasciculata|fibulata|fistulosus|flexuos(?:a|um)|floribund(?:a|um)|florulentus|frutescens|fruticosum|fusiforme|gabrielis|geminiflora|glabra|gladioliflora|grandiflorus|grandis|granvillei|griotii|guianens(?:e|is)|guyanensis|heliconioides|hostmannianum|hymenophyll(?:a|um)|impressifolia|imthurniana|inaequale|incarnata|incurva|insignis|insolita|kanukuensis|kappleriana|kegeliana|kohlerioides|laxiflorum|leprieurii|lingulata|longan|macdonaldae|macranthocarpa|macrostylis|magnoliifolia|maguirei|manarae|marcano-bertii|marginatum|maritima|marowinianum|mathewsii|melinonis|meridensis|micrantha|monadelpha|mucronatum|multiflora|nematanthera|nigricans|nucifera|nutans|obliquum|obtusissimum|ochroprumna|octandra|odoratissima|oliviformis|orinocensis|ovalifolia|pacurero|pallidus|paraguariense|parinarioides|peduncularis|peltat(?:a|um)|penduliflora|perstipulare|peruviana|platynema|pleiosticha|pruinosa|pseudoglabrescens|pteroneuron|purpurascens|quadrangular(?:e|is)|racemosum|radicans|ramboutan-ake|ramosissima|remotinervium|reptans|resinifera|reticulata|retusa|rohrii|roraimae|rotundifolia|rubra|rudgeanum|sagotii|salicifoli(?:a|um)|sandwithii|sapida|scandens|secunda|sessilifolia|sessilis|sinensis|smithii|spec\.|sphaeroidea|spiculosa|spinosum|splendens|splitgerberi|squarrosa|stricta|suaveolens|subciliatum|taboganum|tenuifolia|tetraphylla|trichoneuron|tuberculatum|tuberosa|urocarpa|usneoides|warakabacoura|warmingii))( |, |; |: |\.|\)|<)/$1<fullName rank="species" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Subgenera:
		# Without author:
		s/(subgenus )(Decaloba|Lophotocarpus|Sagittaria|Urostigma)( |,|\.|\)|; |: )/$1<fullName rank="subgenus" freetextName="true">$2<\/fullName>$3/g;
		
		
		
		# Genera:
		# With author:
		s/( |\(|<figureLegend>|<br \/>)((?:Abolboda|Acer|Achatocarpus|Achlyphila|Adenolisianthus|Aldrovandra|Allophylus|Ampelocera|Anisacanthus|Anthodon|Antidaphne|Aptandra|Aratitiyopea|Arceuthobium|Arfeuillea|Aristolochia|Artocarpus|Asarum|Atkinsonia|Avicennia|Bagassa|Batocarpus|Bonellia|Bougainvillea|Boehmeria|Brassiantha|Brosimum|Buchenavia|Calolisianthus|Cardiospermum|Casimirella|Castilla|Casuarina|Cecropia|Celiantha|Celtis|Chaunochiton|Cheiloclinium|Chelonanthus|Chorisepalum|Clarisia|Clavija|Clethra|Combretum|Conocarpus|Coussapoa|Coutoubea|Crantzia|Cuervea|Cupania|Curtia|Cyrilla|Darlingtonia|Deherainia|Dendrobangia|Dendrophthora|Dichapetalum|Dionaea|Discophora|Dorstenia|Drejera|Drosera|Drosophyllum|Dulacia|Elachyptera|Enicostema|Eubrachion|Euphorianthus|Euplassa|Ficus|Filicium|Gaiadendron|Guapira|Guzmania|Gyrocarpus|Harpullia|Heisteria|Helia|Heliamphora|Heliconia|Helicostylis|Hernandia|Hippocratea|Hygrophila|Hylenaea|Irlbachia|Jacquinia|Justicia|Koelreuteria|Laguncularia|Laportea|Lepianthes|Lepidoceras|Leretia|Lisianthus|Lisyanthus|Lophotocarpus|Macrocarpaea|Madura|Maquira|Mendoncia|Mezobromelia|Microtea|Mirabilis|Mollugo|Napeanthus|Naucleopsis|Neea|Nematanthus|Neurotheca|Nuytsia|Orectanthe|Oryctanthus|Oryctina|Panopsis|Paullinia|Pentascyphus|Perebea|Peritassa|Phacellaria|Phenax|Phoradendron|Phthirusa|Pilea|Piper|Pisonia|Pleurisanthes|Polylychnis|Potalia|Pothomorphe|Poulsenia|Pourouma|Prionostemma|Pristimera|Ptychopetalum|Pseudolmedia|Purdiaea|Rhabdodendron|Rhizophora|Rogersonanthus|Roupala|Ruellia|Sagittaria|Saintpaulia|Salacia|Sapindus|Sarawakodendron|Sarracenia|Schleichera|Schoepfia|Schultesia|Sesuvium|Serjania|Sipapoantha|Sorocea|Sparattanthelium|Stephanopodium|Strephonema|Symbolanthus|Tachia|Talisia|Tapeinostemon|Terminalia|Tetrapollinia|Theophrasta|Thiloa|Tillandsia|Tontelea|Trema|Trichanthera|Trymatococcus|Urera|Vernonia|Voyria|Voyriella|Vriesea|Xanthoceras|Xyris) (?:Acev\.-Rodr\.|E\. J\. Alexander|Andre(?: ex Mez|)|Antoine|Aubl(?:\.|et)|Baill(?:\.|)|Baker|Benth(?:\.|am)|Benoist|(?:C\.C\. |)Berg|Blume|Bogin|(?:Humb\. &amp; |)Bonpl\.|Bremek\.|Brongniart|N\.(?: |)E\. Br(?:\.|own)|Buchenau|Cambess\.|Cham\.|Chapm\.|Choisy|J\.L\. Clark|(?:Bertero ex |)Colla|(?:C\. |)DC\.|Decne\.|Desv\.|A\. Dietr\.|(?:D\.|G\.) Don(?: ex Steud\.|)|Ducke|Eichler|(?:Sagot ex |)Engl(?:\.|er)|Exell|Fassett|J\.R\. &amp; G\. Forster|Fosb\.|Fritsch|Garcke|C\.F\. Gaertn\.|Gaud\.(?: ex Wedd\.|)|Gleason|J\.F\. Gmel|Gouda|V\.A\.W\. Graham|Griseb(?:\.|ach)|(?:Klotzsch ex |)Hanst\.|Hara|Heimerl|Hiern|(?:R\.R\. Haynes &amp; |)Holm-Niels\.|Hook\.(?:f\.|)|(?:R\.A\. |)Howard|Jacq\.|Jongkind|Klotzsch|Salisb\. ex Knight|Kosterm\.|Kral|K\. Krause|Krug &amp; Urb\.|Kubitzki|Kuijt|Kuhlm\.|(?:Poeppig ex |)Kunth(?: &amp; C\.D\. Bouché|)|(?:O\. |)Kuntze|L\.(?: f\.|)|Lag\. &amp; Rodr\.|Lam\.|Lanj(?:ouw|\.)(?: &amp; Rossberg|)|Leeuwenb\.|Lindau|Linden|Link(?:, Klotzsch &amp; Otto|)|Lodd\.|Loefl\.|Loes\.|Lundell|Lour\.|Maas(?: &amp; Stoel|)|Macbr\.|Maguire(?: &amp; (?:Wurdack|L\.B\. Smith)|)|(?:Spruce ex |)Malme|(?:Nees &amp; |)Mart(?:\.|ius)(?: ex Nees|)|Masters|Meisn\.|A\.M\. Mennega|Merr\.|G\. Mey\.|Mez|Micheli|(?:Spruce ex |)Miers|Mildbr\.|Mill\.|Miq\.|S. Moore|C\.V\. Morton|Nees|(?:Hieron. ex |)Niederlein|A\. Nilsson|F\. Oliver|Pers\.|Peyr\.|Pitt|Planch\.|Poepp\.(?: &amp; Endl\.|)|Poir\.|Poncy|Prance|C\. Presl|Pulle|(?:Sagot ex |)Radlk\.|Rataj|Rchb\.|Regel|Reitz|(?:L\.C\. |)Rich\.|Rizzini|Roxb\.|Rudge|Ruiz &amp; Pav(?:\.|on)|Rusby|Salisb\.|Sandw\.|Sarg\.|Schott|Schwarz|Seem\.|Sesse|Seub\.|(?:Bojer ex |Donn ex |)Sims|Small|(?:A\.C\.|(?:R\.(?: |)W\. Read &amp; |)L\.B\.) Smith(?: &amp; Pitt(?:\.|endrigh)|)|(?:A\. |)Spreng(?:\.|el)|Spruce|B\. Ståhl|Steud\.|Steyerm\.(?: &amp; Berry|)|Stuntz|Sw\.|Taub\.|J\.V\. Thomps\.|Todzia|Torr\.|Triana|Trecul|Ule|Urb\.|Vahl|Vazquez Avila(?: &amp; C\.C\. Berg)|Veil\.|Vellozo|H\. Walt\.|Wassh\.|Wedd\.|Wendland|Wiehler|Wight|Willd\.|C\.(?:H\.|) Wright|(?:Trel\. &amp; |)Yunck\.))( |,|\.|:|\))/$1<fullName rank="genus" freetextName="true">$2<\/fullName>$3/g;
		# Without author:
		s/( |\(|<figureLegend>|<br \/>|<th>|<td>)(Abolboda|Acer|Achatocarpus|Achlyphila|Adenolisianthus|Aldrovandra|Allophylus|Ampelocera|Anisacanthus|Anthodon|Antidaphne|Aptandra|Aratitiyopea|Arceuthobium|Arfeuillea|Aristolochia|Artocarpus|Asarum|Atkinsonia|Avicennia|Bagassa|Batocarpus|Bonellia|Bougainvillea|Boehmeria|Brassiantha|Brosimum|Buchenavia|Calolisianthus|Cardiospermum|Casimirella|Castilla|Casuarina|Cecropia|Celiantha|Celtis|Chaunochiton|Cheiloclinium|Chelonanthus|Chorisepalum|Clarisia|Clavija|Clethra|Combretum|Conocarpus|Coussapoa|Coutoubea|Crantzia|Cuervea|Cupania|Curtia|Cyrilla|Darlingtonia|Deherainia|Dendrobangia|Dendrophthora|Dichapetalum|Dionaea|Discophora|Dorstenia|Drejera|Drosera|Drosophyllum|Dulacia|Elachyptera|Enicostema|Eubrachion|Euphorianthus|Euplassa|Ficus|Filicium|Gaiadendron|Guapira|Guzmania|Gyrocarpus|Harpullia|Heisteria|Helia|Heliamphora|Heliconia|Helicostylis|Hernandia|Hippocratea|Hygrophila|Hylenaea|Irlbachia|Jacquinia|Justicia|Koelreuteria|Laguncularia|Laportea|Lepianthes|Lepidoceras|Leretia|Lisianthus|Lisyanthus|Lophotocarpus|Macrocarpaea|Madura|Maquira|Mendoncia|Mezobromelia|Microtea|Mirabilis|Mollugo|Napeanthus|Naucleopsis|Neea|Nematanthus|Neurotheca|Nuytsia|Orectanthe|Oryctanthus|Oryctina|Panopsis|Paullinia|Pentascyphus|Perebea|Peritassa|Phacellaria|Phenax|Phoradendron|Phthirusa|Pilea|Piper|Pisonia|Pleurisanthes|Polylychnis|Potalia|Pothomorphe|Poulsenia|Pourouma|Prionostemma|Pristimera|Ptychopetalum|Pseudolmedia|Purdiaea|Rhabdodendron|Rhizophora|Rogersonanthus|Roupala|Ruellia|Sagittaria|Saintpaulia|Salacia|Sapindus|Sarawakodendron|Sarracenia|Schleichera|Schoepfia|Schultesia|Sesuvium|Serjania|Sipapoantha|Sorocea|Sparattanthelium|Stephanopodium|Strephonema|Symbolanthus|Tachia|Talisia|Tapeinostemon|Terminalia|Tetrapollinia|Theophrasta|Thiloa|Tillandsia|Tontelea|Trema|Trichanthera|Trymatococcus|Urera|Vernonia|Voyria|Voyriella|Vriesea|Xanthoceras|Xyris)( |,|\.|\)|: |; |<)/$1<fullName rank="genus" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Species-group:
		s/( |\()(Amplectentes|Attenuatae)( |, |\.|\))/$1<fullName rank="species-group" freetextName="true">$2<\/fullName>$3/g;
		
		# Sections:
		s/( |\()(Americana|Buchenavia|Dolichostachys|Pharmacosycea|Thelocalyx)( |, |\.|\))/$1<fullName rank="section" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Series:
		s/( |\(|ser\. )(Hexandrae|Thyrsicae)( |, |\.|\))/$1<fullName rank="section" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Subtribes:
		s/( |\()(Combretinae|Terminaliinae|Coutoubeinae|Potaliinae|Faroinae)( |, |\.|\))/$1<fullName rank="subtribe" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Tribes:
		s/( |\()(Artocarpeae|Castilleae|Combreteae|Dorstenieae|Ficeae|Laguncularieae|Macadamieae|Moreae|CHIRONIEAE|HELIEAE|POTALIEAE|SACCIFOLIEAE)( |, |\.|\))/$1<fullName rank="tribe" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Subfamilies:
		s/( |\()(Combretoideae|Hippocrateoideae|LORANTHACEAE subfam\. VISCOIDEAE|Salacioideae|Strephonematoideae|Tillandsioideae)( |, |\.|\))/$1<fullName rank="subfamily" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Families:
		s/( |\()(A(?:CANTHACEAE|canthaceae)|ACHATOCARPACEAE|AIZOACEAE|Apiaceae|Cecropiaceae|Celastraceae|CHENOPODIACEAE|CHRYSOBALANACEAE|CLETHRACEAE|C(?:OMBRETACEAE|ombretaceae)|CYRILLACEAE|DICHAPETALACEAE|Droseraceae|E(?:remolepidaceae|REMOLEPIDACEAE)|ERICACEAE|GENTIANACEAE|G(?:esneriaceae|ESNERIACEAE)|Hippocrateaceae|Icacinaceae|LOGANIACEAE|L(?:oranthaceae|ORANTHACEAE)(?: s\.s\.|)|Marantaceae|M(?:ENDONCIACEAE|endonciaceae)|Menispermaceae|M(?:isodendraceae|ISODENDRACEAE)|MOLLUGINACEAE|Moraceae|Nyctaginaceae|Olacaceae|PHYTOLACCACEAE|Piperaceae|PROTEACEAE|RUTACEAE|S(?:antalaceae|ANTALACEAE)|S(?:apindaceae|APINDACEAE)|THEOPHRASTACEAE|Ulmaceae|V(?:iscaceae|ISCACEAE))( |, |\.|\)|:)/$1<fullName rank="family" freetextName="true">$2<\/fullName>$3/g;
		
		
		# Orders:
		s/( )(Celastrales|ERICALES|S(?:antalales|ANTALALES))( |, |\.)/$1<fullName rank="order" freetextName="true">$2<\/fullName>$3/g;
		
		
		
	}
	
	

		print OUT $_;

}

close IN;
close OUT;